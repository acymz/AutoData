name: Run Python Script

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0  # 确保历史记录和标签都被获取
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: 3.x  # 指定Python版本
    - name: Install dependencies
      run: |
        pip install pyinstaller
    - name: Build EXE with PyInstaller
      run: |
        pyinstaller --onefile clan2.py
    - name: Commit and push EXE
      run: |
        mkdir exefile  # 创建exefile目录
        mv dist/clan2.exe exefile/  # 移动EXE文件到exefile目录
        git config --global user.name "acymz"
        git config --global user.email "cymz6@hotmail.com"
        git add exefile/clan2.exe  # 添加EXE文件到暂存区
        git commit -m "Add built EXE"  # 创建提交
        git push  # 推送到GitHub仓库
    - name: Upload EXE as artifact
      uses: actions/upload-artifact@v3
      with:
        name: exefile
        path: exefile
